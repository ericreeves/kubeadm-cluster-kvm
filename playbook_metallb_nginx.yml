---

# put MetalLB as peer on host network
- hosts: localhost
  connection: local
  tasks:
    - set_fact:
        metal_lb_prefix: "{{ ansible_default_ipv4.address.split('.')[:3]|join('.') }}"
    - set_fact:
        metal_lb_primary: "{{metal_lb_prefix}}.145"

- hosts: control_plane
  gather_facts: yes
  become: yes
  roles:
    # public LB endpoints managed by MetalLB
    - role: kubeadm-metallb

    # nginx ingress
    - role: add_primary_nginx_ingress

    # deploys hello world app
    - { role: golang-hello-world-web, do_second_ingress: false }

